version: 1
send_anonymous_usage_stats: true
project_id: tap-fred
default_environment: dev
venv:
  backend: uv
environments:
  - name: dev
    config:
      plugins:
        loaders:
          - name: target-postgres
            config:
              default_target_schema: tap_fred_dev

  - name: production
    config:
      plugins:
        loaders:
          - name: target-postgres
            config:
              default_target_schema: tap_fred_production
plugins:
  extractors:
  - name: tap-fred
    namespace: tap_fred
    pip_url: git+https://github.com/melgazar9/tap-fred.git
    capabilities:
    - state
    - catalog
    - discover
    - about
    - stream-maps

    settings_group_validation:
    - [api_key]

    settings:
    - name: api_key
      kind: string
      label: FRED API Key
      description: Your FRED API key from 
        https://fred.stlouisfed.org/docs/api/api_key.html
      sensitive: true

    - name: series_ids
      label: Series IDs
      description: FRED series IDs to extract (e.g., 'GDP' or ['GDP', 'UNRATE'] 
        or '*' for defaults)

    - name: start_date
      kind: date_iso8601
      label: Start Date
      description: Earliest observation date to extract

    - name: api_url
      label: API Base URL
      description: FRED API base URL

    - name: user_agent
      label: User Agent
      description: Custom User-Agent header for requests

    - name: max_requests_per_minute
      label: Max Requests Per Minute
      description: Maximum API requests per minute (default 60, FRED allows up 
        to 120)
      default: 60

    - name: min_throttle_seconds
      label: Minimum Throttle Seconds
      description: Minimum seconds between consecutive API requests (default 1.0
        for 60/min rate)
      default: 0.5

    # Per-stream configurable query parameters (optional)
    - name: default_params
      kind: object
      label: Default Parameters
      description: Default query/path parameters for all streams

    - name: series_observations_params
      kind: object
      label: Series Observations Parameters
      description: Custom parameters for series_observations stream

    - name: releases_params
      kind: object
      label: Releases Parameters
      description: Custom parameters for releases stream

    # FRED vs ALFRED mode settings
    - name: data_mode
      kind: options
      label: Data Mode
      description: FRED for current revised data, ALFRED for vintage historical 
        data
      options:
      - label: FRED (Current Revised Data)
        value: FRED
      - label: ALFRED (Vintage Historical Data)
        value: ALFRED
      default: FRED

    - name: realtime_start
      kind: date_iso8601
      label: Realtime Start Date
      description: Global vintage date for regular ALFRED mode (YYYY-MM-DD). 
        Used when data_mode=ALFRED and point_in_time_mode=false

    - name: realtime_end
      kind: date_iso8601
      label: Realtime End Date
      description: End vintage date for regular ALFRED mode (YYYY-MM-DD). 
        Used when data_mode=ALFRED and point_in_time_mode=false

    # Point-in-Time Mode Settings
    - name: point_in_time_mode
      kind: boolean
      label: Point-in-Time Mode
      description: Enable individual vintage date partitions. When true, creates 
        separate partitions for each vintage date within the specified range
      default: false

    - name: point_in_time_start
      kind: date_iso8601
      label: Point-in-Time Start Date
      description: Filter vintage dates from this date (YYYY-MM-DD). Only used 
        when point_in_time_mode=true to limit the vintage date range

    - name: point_in_time_end
      kind: date_iso8601
      label: Point-in-Time End Date
      description: Filter vintage dates up to this date (YYYY-MM-DD). Only used when
        point_in_time_mode=true to limit the vintage date range

    # Configurable Selection Filters
    - name: category_ids
      kind: array
      label: Category IDs
      description: Specific FRED category IDs to extract (e.g., ['18', '32992'] 
        or ['*'] for all)

    - name: release_ids
      kind: array
      label: Release IDs
      description: Specific FRED release IDs to extract (e.g., ['53', '151'] or 
        ['*'] for all)

    - name: source_ids
      kind: array
      label: Source IDs
      description: Specific FRED source IDs to extract (e.g., ['1', '3'] or 
        ['*'] for all)

    - name: tag_names
      kind: array
      label: Tag Names
      description: Specific FRED tag names to extract (e.g., ['gdp', 
        'inflation'] or ['*'] for all)

    - name: search_text
      label: Search Text
      description: Search term for series search streams (default empty)

    # GeoFRED Maps Configuration
    - name: geofred_regional_params
      kind: array
      label: GeoFRED Regional Parameters
      description: "Array of parameter sets for regional data extraction"

    - name: geofred_series_ids
      kind: array
      label: GeoFRED Series IDs
      description: "Specific GeoFRED series IDs to extract"

    config:
      api_key: ${FRED_API_KEY}
      api_url: https://api.stlouisfed.org/fred
      start_date: '1776-01-01'             # All historical data from beginning of time
      max_requests_per_minute: 60
      min_throttle_seconds: 1.0

      series_ids: ["*"]                     # Wildcard: discover all FRED series
      category_ids: ["*"]                   # Wildcard: discover all categories
      release_ids: ["*"]                    # Wildcard: discover all releases
      source_ids: ["*"]                     # Wildcard: discover all sources
      tag_names: ["*"]                      # Wildcard: discover all tags
      # search_text: "gdp"                   # Optional: search term for series search streams

      # GeoFRED Maps Configuration - Wildcard support validated
      geofred_regional_params:
        - series_group: "882"
          region_type: "*"
          season: "*"
          date: "2020-01-01"
          units: "Dollars"
          frequency: "a"
      geofred_series_ids: ["*"]             # Wildcard: discover all GeoFRED series

      # FRED Mode Configuration - Current data for GeoFRED testing
      data_mode: ALFRED                      # Current revised data
      # realtime_start: '2020-01-01'         # Historical vintage date for testing
      # realtime_end: '2020-01-01'           # Point-in-time accuracy

      default_params:
        query_params:
          limit: 1000

    select:
      # All FRED API streams selected for comprehensive data extraction
      # ALFRED mode preserves vintage dates for historical data accuracy

      # Core economic time series data
      - series_observations.*         # Time series data with vintage dates
      - series_vintage_dates.*        # Complete revision history per series

      # Series metadata and relationships
      - series.*                      # Series definitions and metadata
      - series_categories.*           # Series-to-category relationships
      - series_release.*              # Series-to-release mapping
      - series_search.*               # Series discovery via search
      - series_search_tags.*          # Search-based tag relationships
      - series_search_related_tags.*  # Related tags for search expansion
      - series_tags.*                 # Series tagging for categorization
      - series_updates.*              # Series update tracking

      # Category hierarchy and taxonomy
      - categories.*                  # Main category definitions
      - category_children.*           # Parent-child category relationships
      - category_related.*            # Related category discovery
      - category_series.*             # Category-to-series mappings
      - category_tags.*               # Category tagging system
      - category_related_tags.*       # Related tags per category

      # Release publications and schedules
      - releases.*                    # Publication release definitions
      - release.*                     # Individual release details
      - release_dates.*               # Release publication dates
      - release_series.*              # Release-to-series mappings
      - release_sources.*             # Release data sources
      - release_tags.*                # Release tagging
      - release_related_tags.*        # Related tags per release
      - release_tables.*              # Release table structures

      # Data sources and institutional metadata
      - sources.*                     # Data source definitions (BLS, BEA, etc.)
      - source.*                      # Individual source details
      - source_releases.*             # Source-to-release relationships

      # Topic/keyword taxonomy system
      - tags.*                        # Tag definitions and metadata
      - related_tags.*                # Tag relationship discovery
      - tags_series.*                 # Tag-to-series mappings

      # Geographic and regional data
      - geofred_regional_data.*       # Regional economic indicators
      - geofred_series_data.*         # Geographic series data

  loaders:
  - name: target-jsonl
    variant: andyh1203
    pip_url: target-jsonl

  - name: target-postgres
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/target-postgres
    config:
      host: ${POSTGRES_HOST}
      port: ${POSTGRES_PORT}
      user: ${POSTGRES_USER}
      password: ${POSTGRES_PASSWORD}
      dialect: ${POSTGRES_DIALECT}
      database: financial_elt
      max_batch_size: 10000
      load_method: upsert
      use_copy: true
      add_record_metadata: true
